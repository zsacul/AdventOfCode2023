use std::collections::{HashMap,HashSet, VecDeque};
use super::vec2::Vec2;

#[derive(Debug)]
struct World
{
    hash    : HashMap<Vec2,char>,
    steps   : HashMap<Vec2,u64>,
    dx      : i64,
    dy      : i64,
}

impl World
{
    fn get_data(v:&[String])->HashMap<Vec2,char> 
    {
        let mut hash = HashMap::new();
    
        for (y,line) in v.iter().enumerate() 
        {
            for x in 0..v[y].len() 
            {
                let c= line.chars().nth(x).unwrap();
                
                if c!='.'
                {
                    hash.insert(Vec2::new(x as i64,y as i64),c); 
                }
            }
        }
        hash
    }

    fn c(&self,p:Vec2)->char
    {
        *self.hash.get(&p).unwrap_or(&'.')
    }

    //ppp
    //ppp
    //ppp

    fn c2(&self,p:Vec2)->char
    {
        let dx = self.dx as usize;
        let dy = self.dy as usize;
        let hx = ((self.dx as i64-1))/2;
        let hy = ((self.dy as i64-1))/2;
        let xx = (p.x + hx + 99999999*self.dx) as usize % dx;
        let yy = (p.y + hy + 99999999*self.dy) as usize % dy;
        let pp = Vec2::new( xx as i64,  yy as i64);

        *self.hash.get(&pp).unwrap_or(&'.')
    }

    fn s(&self,p:Vec2)->u64
    {
        *self.steps.get(&p).unwrap_or(&0)
    }

    fn make_step(&mut self,pos:Vec2,step:usize)
    {
        let v = self.steps.get(&pos).unwrap_or(&0);
        self.steps.insert(pos,v | (1<<step));
    }

    fn res(&self,steps:usize)->usize
    {
        let code = 1<<steps;
        self.steps.values().filter(|c| **c&code == code).count()
    }

    fn new(v:&[String])->World 
    {
        World 
        { 
            hash  : World::get_data(v),
            steps : HashMap::new(),
            dx    : v[0].len() as i64,
            dy    :    v.len() as i64,
        }    
    }

    #[allow(dead_code)]
    fn print(&self)
    {
        println!();
        println!("dx = {}, dy = {}",self.dx,self.dy);

        for y in 0..self.dy
        {
            for x in 0..self.dx
            {
                let c = self.hash.get(&Vec2::new(x,y)).unwrap_or(&'.');
                print!("{}",c);
            }
            println!();
        }
    }

    #[allow(dead_code)]
    fn print_hash(&self,hash:&HashSet<Vec2>,step:usize,cage:usize)
    {
        println!();
        println!("dx = {}, dy = {}",self.dx,self.dy);
        println!("step = {}, cage = {}",step,cage);
        let s = step as i64;

        for yy in -s..=s
        {
            for xx in -s..=s
            {
                let x = xx;
                let y = yy;
                let p = Vec2::new(x as i64,y as i64);
                let c = hash.get(&p).is_some();


                let cc = (cage-1)/2;
                let ix = (cc as i64+x+999999i64*cage as i64)/(cage as i64);
                let iy = (cc as i64+y+999999i64*cage as i64)/(cage as i64);

                if Vec2::zero().distance2(xx,yy).abs()>s
                {
                    print!(" ");
                }
                else
                if (ix+iy)%2==0
                {
                    if c { print!("-"); }
                    else { print!("©"); }
                }
                  else
                {
                    if c { print!("-"); }
                    else { print!("®"); }//print!("."); }
                }
            }
            println!();
        }
    }

    #[allow(dead_code)]
    fn printb(&self)
    {
        println!();
        println!("dx = {}, dy = {}",self.dx,self.dy);

        for y in 0..self.dy
        {
            for x in 0..self.dx
            {
                let c = self.steps.get(&Vec2::new(x,y)).unwrap_or(&0);

                match c
                {
                    0 => print!("."),
                    1 => print!("^"),
                    2 => print!(">"),
                    4 => print!("<"),
                    8 => print!("v"),
                    _ => print!("?"),
                    
                }
            }
            println!();
        }
    }

    fn calc(&mut self,steps:usize)->usize
    {
        let mut list = VecDeque::new();
        let pos = *self.hash.iter().find(|(_,c)| **c=='S').unwrap().0;
        self.hash.insert(pos,'.');

        //self.print();
        println!("pos={:?}",pos);

        list.push_back(pos);

        let mut hash :HashMap<Vec2,u128> = HashMap::new();
        let mut hashn:HashMap<Vec2,u128> = HashMap::new();
        hashn.insert(pos,1u128);
        
        for s in 0..steps
        {
            hash = hashn.clone();
            hashn.clear();

            let moves = list.len();
            for _ in 0..moves
            {
                let pos = list.pop_front().unwrap();
                let val = *hash.get(&pos).unwrap_or(&0);

                if val>0 
                {
                    for p in pos.around4()
                    {
                        if self.c(p)!='#'
                        {
                            let was = *hashn.get(&p).unwrap_or(&0);
                            hashn.insert(p,was+val);
                          //  println!("p={:?},val={},was={}",p,val,was);
                            list.push_back(p);
                        }
                    }                        
                }
            }
            list = hashn.keys().map(|k| *k).collect();
        }
        hashn.values().count()

        //panic!("err");
    }

    fn calc2(&mut self,steps:usize)->HashSet<Vec2>
    {
        let mut list = VecDeque::new();
        let pos = Vec2::new(0,0);// *self.hash.iter().find(|(_,c)| **c=='S').unwrap().0;

        println!("pos = {:?}",pos);
        self.hash.insert(pos,'.');

        list.push_back(pos);

        let mut hash  : HashSet<Vec2> = HashSet::new();
        let mut hashn : HashSet<Vec2> = HashSet::new();
        hashn.insert(pos);
     
        for _ in 0..steps
        {
            hash = hashn.clone();
            hashn.clear();

            let moves = list.len();
            for _ in 0..moves
            {
                let pos = list.pop_front().unwrap();
                let val = hash.get(&pos).is_some();

                if val
                {
                    for p in pos.around4()
                    {
                        if self.c2(p)!='#'
                        {
                            hashn.insert(p);
                            list.push_back(p);
                        }
                    }                        
                }
            }
            list = hashn.iter().map(|k| *k).collect();
        }
        //hashn.len()
        hashn
    }


    fn count(&self,h:&HashSet<Vec2>,x:i64,y:i64,s:i64)->usize
    {
        let mut res = 0;
        let l = 2*s+1;

        for y in y*l-s..=y*l+s
        {
            for x in x*l-s..=x*l+s
            {
                if h.get(&Vec2::new(x,y)).is_some() 
                {
                    res+=1;
                }
            }
        }
        res
    }

    fn count3(&self,memo:&mut HashMap<(i64,i64,i64),usize>,h:&mut HashSet<Vec2>,x:i64,y:i64,s:i64,steps:usize)->usize
    {
        let l = 2*s+1;
        let mut list = VecDeque::new();
        let mut pos = Vec2::new( x*l,y*l);// *self.hash.iter().find(|(_,c)| **c=='S').unwrap().0;

        if x==0 && y==0
        {
        }
          else 
        {          
            if y>0 { pos.y-=s; }
            if y<0 { pos.y+=s; }
            if x>0 { pos.x-=s; }
            if x<0 { pos.x+=s; }
        }

        let left_steps = steps as i64- pos.x.abs() - pos.y.abs();

        if left_steps<=0 
        {
            return 0;
        }
        
        let xm = (pos.x + 99999999*l)%l;
        let ym = (pos.y + 99999999*l)%l;
        let key = (xm,ym,left_steps);

        //println!("{:?}",key);

        if memo.get(&key).is_some()
        {
            memo.get(&key).unwrap();
        }

        list.push_back(pos);

        let mut hash  : HashSet<Vec2> = HashSet::new();
        let mut hashn : HashSet<Vec2> = HashSet::new();
        hashn.insert(pos);

        for _ in 0..left_steps
        {
            hash = hashn.clone();
            hashn.clear();

            let moves = list.len();
            for _ in 0..moves
            {
                let pos = list.pop_front().unwrap();
                let val = hash.get(&pos).is_some();

                if val
                {
                    for p in pos.around4()
                    {
                        if self.c2(p)!='#'
                        {
                            hashn.insert(p);
                            list.push_back(p);
                        }
                    }                        
                }
            }
            list = hashn.iter().map(|k| *k).collect();
        }
        //hashn.len()

        let res = 
        list.iter()
            .filter(|p| p.x>=x*l-s && p.x<=x*l+s && 
                                p.y>=y*l-s && p.y<=y*l+s)
            .count();

        memo.insert(key,res);

        res
    }


    fn calc3(&mut self,steps:i64)->usize
    {
        let print = !true;
        let h = self.calc2(271 as usize);
                
        if print
        {
            println!("result:{}",h.len());
        }

        let s = 65;
        let odd     = self.count(&h, 0, 0,s) as i64;
        let even    = self.count(&h, 1, 0,s) as i64;
        let isteps = steps/s;

        //self.print_hash(&h, steps as usize+1,s as usize);
        
        let n_even = (isteps-1)/2;
        let n_odd  = isteps-n_even;
        
        let ll = (2*s+1);
        let nn = (steps+2*s)/ll;
/*
        let mut sum1=0;
        for yy in -nn..=nn
        {
            for xx in -nn..=nn
            {
                let ev = self.count(&h,xx,yy,s) as i64;        
                sum1+=ev;

                if print { print!("[{:>5}]",ev); }
            }
            if print { println!(""); }
        }

        if print { println!(""); }
        */
        let mut memo = HashMap::new();

        let mut sum2 = 0;

        for yy in -nn..=nn
        {
//            if yy%100==0
            {
                println!("y={}",yy);
            }
            for xx in -nn..=nn
            {
                let mut h : HashSet::<Vec2> = HashSet::new();
                let ss  = (steps - xx.abs()*ll - yy.abs()*ll);
                let mut ev = 0;
                //  println!("steps left:{}",ss);

                if xx.abs()+yy.abs()<=nn
                {
                    if xx.abs()+yy.abs()<=nn-2
                    {
                        if (xx+yy)%2==0
                        {
                            ev = odd;
                        }
                        else {
                            ev = even;
                        }
                    }
                    else
                    {
                        ev = self.count3(&mut memo,&mut h,xx,yy,s,steps as usize) as i64;
                    }
                }


                sum2+=ev;

                if print { 
                print!("[{:>5}]",ev);
                }
            }
            if print { 
                println!("");
            }
        }
        /*
        println!("odd    {}",odd);
        println!("even   {}",even);
        println!("even2  {}",even2);
        println!("even3  {}",even3);
        println!("even4  {}",even4);
        println!("n_odd  {}",n_odd);
        println!("n_even {}",n_even);

        */
        //println!("sum1:{}",sum1);
        println!("sum2:{}",sum2);

        sum2 as usize

        //(n_even*even +
          //n_odd*odd ) as usize
    }

}


pub fn part1(data:&[String],steps:usize)->usize
{
    let mut w  = World::new(data);
    w.calc(steps)

    //let n = tools::i32_get_between(data[0], "(", ")");
    //r.iter()
    //.map(|s| hash(s))
    //.sum() 
}

pub fn part2(data:&[String],steps:usize)->usize
{
    let mut w = World::new(data);
    w.calc3(steps as i64)
    //w.calc(steps)
    //let r: Vec<&str> = data[0].split(',').collect();
//    w.calc2(steps).len()

}

#[allow(unused)]
pub fn solve(data:&[String])
{    
    println!("Day21");
    println!("part1:{}",part1(data,64));
    println!("part2:{}",part2(data,26501365));

//  let v = get_big_field();
//  let t = part2(&v,5000);

  //let v = get_21_field();
  //assert_eq!(part2(&v,701), 51922);

  //,16733044);

  //part2(data,26501365);
}

#[allow(unused)]
fn get_data_small()->Vec<String>
{
    vec![
        "...........".to_string(),
        ".....###.#.".to_string(),
        ".###.##..#.".to_string(),
        "..#.#...#..".to_string(),
        "....#.#....".to_string(),
        ".##..S####.".to_string(),
        ".##..#...#.".to_string(),
        ".......##..".to_string(),
        ".##.#.####.".to_string(),
        ".##..##.##.".to_string(),
        "...........".to_string(),
    ]
}

#[test]
fn test1()
{
    let v = get_data_small();
    assert_eq!(part1(&v,1),2);
}

#[test]
fn test2()
{
    let v = get_data_small();
    assert_eq!(part1(&v,2),4);
}


#[test]
fn test3()
{
    let v = get_data_small();
    assert_eq!(part1(&v,3),6);
}


#[test]
fn test4()
{
    let v = get_data_small();
    assert_eq!(part1(&v,6),16);
}

fn get_big_field()->Vec<String>
{
    let v = 
    vec![
        ".................................".to_string(),
        ".....###.#......###.#......###.#.".to_string(),
        ".###.##..#..###.##..#..###.##..#.".to_string(),
        "..#.#...#....#.#...#....#.#...#..".to_string(),
        "....#.#........#.#........#.#....".to_string(),
        ".##...####..##...####..##...####.".to_string(),
        ".##..#...#..##..#...#..##..#...#.".to_string(),
        ".......##.........##.........##..".to_string(),
        ".##.#.####..##.#.####..##.#.####.".to_string(),
        ".##..##.##..##..##.##..##..##.##.".to_string(),
        ".................................".to_string(),
        ".................................".to_string(),
        ".....###.#......###.#......###.#.".to_string(),
        ".###.##..#..###.##..#..###.##..#.".to_string(),
        "..#.#...#....#.#...#....#.#...#..".to_string(),
        "....#.#........#.#........#.#....".to_string(),
        ".##...####..##..S####..##...####.".to_string(),
        ".##..#...#..##..#...#..##..#...#.".to_string(),
        ".......##.........##.........##..".to_string(),
        ".##.#.####..##.#.####..##.#.####.".to_string(),
        ".##..##.##..##..##.##..##..##.##.".to_string(),
        ".................................".to_string(),
        ".................................".to_string(),
        ".....###.#......###.#......###.#.".to_string(),
        ".###.##..#..###.##..#..###.##..#.".to_string(),
        "..#.#...#....#.#...#....#.#...#..".to_string(),
        "....#.#........#.#........#.#....".to_string(),
        ".##...####..##...####..##...####.".to_string(),
        ".##..#...#..##..#...#..##..#...#.".to_string(),
        ".......##.........##.........##..".to_string(),
        ".##.#.####..##.#.####..##.#.####.".to_string(),
        ".##..##.##..##..##.##..##..##.##.".to_string(),
        ".................................".to_string(),
    ];
    v
}

#[test]
fn test2_1()
{
    let v = get_data_small();
    assert_eq!(part2(&v,6),16);
}


#[test]
fn test2_2()
{
    let v = get_big_field();
    assert_eq!(part2(&v,10),50);
}


#[test]
fn test2_3()
{
    let v = get_big_field();
    assert_eq!(part2(&v,50),1594);
}


#[test]
fn test2_4()
{
    let v = get_big_field();
    assert_eq!(part2(&v,100),6536);
}

fn test2_5()
{
    let v = get_big_field();
    assert_eq!(part2(&v,500),167004);
}

fn test2_6()
{
    let v = get_big_field();
    assert_eq!(part2(&v,1000),668697);
}

#[test]
fn test2_7()
{
    let v = get_big_field();
    assert_eq!(part2(&v,5000),16733044);
}


fn get_21_field()->Vec<String>
{

    vec![
        "...................................................................................................................................".to_string(),
        ".........#.............#..#.................................#..........#......##.............#.#..#.#......................##......".to_string(),
        "...#.................#.....#........#.#............#...#...#................##............#...#.............#.....#.......#........".to_string(),
        "...........#.#.#...........#................#....#....................................#........#..#...............#................".to_string(),
        "...#.......#...#...#...........#.#....##...........#...#...............................#..................#..#.#..#....#.#.#.......".to_string(),
        "..##.#.................#........#...........................................#...#...................................#..............".to_string(),
        "......#......................##....##......#.......................................#.........#........#...........#.#..............".to_string(),
        "...#.....#.......#...............#....##...#......#..#.......................#...#.#....#.........#.#.......#......................".to_string(),
        "..................................#...#.............#.............#.#..............#.......#.....................#.#...............".to_string(),
        "..#........#...............#....#....##.....#.....#..............................#.....#...#...#..#..............#.................".to_string(),
        ".#................................#.............##................#...#...................#............#.#....#...#.#.....#..#.....".to_string(),
        "..............#......#......................#.............#..#.........................#......##....#...........#.........#...###..".to_string(),
        "...#..............#.............#.....##.........#...................#...#...........#.....#..........#...............#.........#..".to_string(),
        "...#........#......................#.#....#...#...............#....................................#.#..#..........................".to_string(),
        "..........#.#.........#...#...#..........#..#...............#.........#....#..................................##.#.................".to_string(),
        "..#...........#...............#.........#...#.........##...#....#....................#....#..#.....#.....###.#.....#...............".to_string(),
        "...........................................#................#..............##............#.....#...#...............#...##.....##...".to_string(),
        ".......#...........#....#.....#.......................#.##..........#...#.................#.......#...................##...........".to_string(),
        "...........#.....#............#........#............#..........#.........##..#...................#..........................#......".to_string(),
        ".......#....#..##..........#..........#..............#.##.............................................#.....#.....#...#.#....#.....".to_string(),
        "..#...#.............#......#.#....#....#.........#.....#............#....#.......#.......#..#.#.....#...........#.............#.#..".to_string(),
        "...#.......#.....#...#.......##....#............................#...........#.............................#........#........#....#.".to_string(),
        ".............#.....##.#............#.#............................................#........#........#...#........#........##.#..#..".to_string(),
        ".....#..#..#......#.............................#.......#.........#..#.............#................##..#.........#........#.......".to_string(),
        "....#.......#...............#......#............................#.......#.#.............................................#..#.......".to_string(),
        ".....#.........#..............#..............#...............#..........#.........................#.#...#..#.......#........#...#..".to_string(),
        ".........................#.............................#...#.......#................................#.....#.#.....#...........#....".to_string(),
        "..............#......#......................##....#................#....#...........##.................#.........#.....##..........".to_string(),
        "..........#.....................#.........#...........#.....#........#...................................#.........................".to_string(),
        "..#...#..##..............#..............#.......#...............#.#.......#...........#.#.................##......#.........#.#....".to_string(),
        ".....##........#....##......#..................#...#...................#...........##.##..#...........#............#...............".to_string(),
        "...#............#..#...#.................#................................#.....#..#.....#...........#..#......#.##...#..#.....#...".to_string(),
        "......#.#...#...#......................#..#....................#......................................#......#...........#..#...#..".to_string(),
        "..............................................#..##...............#.......#..#...#.......##.#.#.........................#...#......".to_string(),
        "..#......#...#...........#..........#.....................#..........##...#....#.#......#..#.......................................".to_string(),
        "....#.......##..............................................#........##.....#......#.#..............................#........#.....".to_string(),
        "..................##..#.................................#........................................................#............#....".to_string(),
        "......#....#.........................#.#......#.....##......#........#.#........#.............#...........#..................#.....".to_string(),
        ".##....................#.............#.....#..........#...#.........##..........#............##.............#........#.............".to_string(),
        "..............#.....#............#.......................#.....##.........##..#........................................#...........".to_string(),
        "..............#...................................#.#.#......#..#....#............##.#..#.................................#........".to_string(),
        "....#..#............................#..#...#.......................................................#...........................#...".to_string(),
        "........#......#...........#.#.........##.#................#.##.....................#...............................#..............".to_string(),
        "...........................#......#.........................#..#..#...........#.................#.............................#..#.".to_string(),
        "......#...................#...#.........#.....#.........#.......#....#.......#......#...#.................................#........".to_string(),
        "....#.#..#...#...........#....#...........#..........#.........#........................#.#...............#.............#..........".to_string(),
        ".#............#.......................................#......#.#............###...................##.....#.............#...........".to_string(),
        ".......#....................................#.#..........#.#...#.........#.....#................#.....#...#........................".to_string(),
        "...........#.......................##.....#..#........##..............#.............#...........................................#..".to_string(),
        "........#.##.........#..........#........#.................#..............#......###....#........#.....................#.#.....#...".to_string(),
        ".....##.#...................#.............#........................#..................#..................###.............#.........".to_string(),
        "......................#.............#.#.....#..#............#......#...#.#.................#....#........#...................#.....".to_string(),
        "..#..................#.#..#............#.......#..............................................................#.#................#.".to_string(),
        "..#...#.................#..#.........#........#...#.#.#......#....#.#...#............#...........#.......#.........................".to_string(),
        "..#........................##...............................#.......#.......##.........#....#........#......#...............#......".to_string(),
        "...............#.#...........#...........#................#.#..#.........#.........#.........#..................#..#..........#....".to_string(),
        ".............#......#......#..#.#......#...#.#.................................#........#..#......#................#...........##..".to_string(),
        "............#.........................#..................................#......#...........#........#.............................".to_string(),
        "...#.......#.................#............#........................#.#...........#.#.............#.................................".to_string(),
        ".............#.......#.........#..............#..#..#.......#..............##.........#....#........##.#...#.......................".to_string(),
        ".....................#.#.........#.....#..#.........#................##.....#.#....................#........#......................".to_string(),
        "........#.........#......#...#.#............................#.......#..............#....#............#..###....#....#.#............".to_string(),
        "..................#.##..##.....#....#........................#..#....................#..#.....#..#..............#..................".to_string(),
        "..........#..##..........#.......##.#..#...........#..............#..#..........................#....#........#........#...........".to_string(),
        ".............#...#..#......#.#.....................................#..#.............#.......#....#............#....................".to_string(),
        ".................................................................S.................................................................".to_string(),
        ".................##.#...#.......#.....................#.#..............#......#..........#.##.........#.........##.................".to_string(),
        "............................#..#..................#............##................#.......#.....##........................##........".to_string(),
        "..................#......................#............#....#.#..#.....#..........#.#........................#.......#....#.........".to_string(),
        "........##.....#.#.........................#..#.....#...#.....#....#...#...#............#...............#.#........................".to_string(),
        "..............#....#.#...............#......#...............................#......#......#..............#.........................".to_string(),
        ".#.............##..#...................#.......#...........#...#................#.......#.........#.#...#..........#.#..#..........".to_string(),
        "......................#....................#.........................#.#........#........#............#....#......#.............#..".to_string(),
        "...#...............#......##......#.......#.....#..#.....#.................#..#.#.........#.....#........#....#....................".to_string(),
        "......................#....#...............#.....................................#.................#.........................#.#...".to_string(),
        ".....#.............#.....................#................#.......##...............................................................".to_string(),
        "...#...........#..................#............#........#...............#.............#......................................#.#...".to_string(),
        ".....#...............#.#......#.#...#..#...#..#........#.............................#.............#.........................#.....".to_string(),
        ".#.................#.....................#.......#..........#..........#....#.......#............#...#...#.........................".to_string(),
        ".........#..............##...............#.............#..#...#..............##....#..#.#.#..#...#.....#...#.....................#.".to_string(),
        ".#.......#.#...................#.#...............#.....#...#............................#....#......#..............................".to_string(),
        "....................#...#.....#................#..........#.....................................#....#.#.....#.....................".to_string(),
        ".........................................#.....#...............#.......#.........#.#.#......#...#.........................#...##...".to_string(),
        "..#.##...........................#.#.................................................#.......#.#....................#.....#..##....".to_string(),
        "..#.........#..#........##................#.......#..................#.#.........#.#.......#................................#......".to_string(),
        "....#....#................#..........#.#..........#...........#...#............#.....#................#..............#..#....#.....".to_string(),
        "..#.............#........#.....#...#..........#.........#...........#.......#............................#..................#.##...".to_string(),
        "....##...........##.............#...........#......#..........#.....#........................#.###................#.......#.....#..".to_string(),
        "........#..#.......................................................#.......#..........##.#..........#.#.............#.....#.#.#.#..".to_string(),
        ".#.#......#.###.................#....................................#...#..#..............#....#.#..##............#..#............".to_string(),
        "...........#....#...............##.#......#....#...#............................................#....#.........................#...".to_string(),
        "....#.............#................................#.......#...#..........##..................#...............................#....".to_string(),
        "........#.#.#..#.....................#.....##.#..#.......#..........#............................#........................#........".to_string(),
        "...........#.....................##.........#...#..........#....................##....................................##....#...#..".to_string(),
        ".....#.#......................................##........#..................#................................#.........#............".to_string(),
        "...#....#......#.....#....................#.............#...#......#.#...#............#..##...........................#........#...".to_string(),
        "..#....................#.............................#..........#.................##..##.#...#...................#....#.....##.....".to_string(),
        "...........................................##................#..#...........................#.............#.....#.............#.#..".to_string(),
        ".....................#......#.........#......#.......#.............................#...............................#........###....".to_string(),
        "............#........#......#.#..............##................#...#...................................................#...........".to_string(),
        ".................#...........#....................#..#............#.........#......................#..#.....................#......".to_string(),
        ".#..............#............##..................#..#...#....#....##.......#..#.#........#.........#.......#..#...#................".to_string(),
        "............#...#.................................#.#........................###....#..........................#.................#.".to_string(),
        ".......#.....#.........#....................#.............#..........#............#............................................##..".to_string(),
        "............#..#..............#....#............#.......#...#.....#........#........#...........#..#...#.....................#.#...".to_string(),
        "....#.#...........................#..............#...........#.......#................#...........#.##.....#............#..#.......".to_string(),
        "..........#...........#...#......#...............#.............#.......#......................#..........................#.........".to_string(),
        "..#.......#.#............#.......#...............#.......#................................................#.......#................".to_string(),
        "............#..............#........#..........#...#.....................#....#.............#.#.###.......#....#...................".to_string(),
        "....#..........#.#.....#.............#.................#......##.........#.......#..........#..................#........#..........".to_string(),
        "..#.#.#.........##....#.........#..........................###............................#......##...#.......#........#.......#...".to_string(),
        "....#....#.....................#..................#.#.#...............#........#..........................#.....#..............##..".to_string(),
        ".......#...#......#.......#..............#..................#.##........#.#.................................#......#..........#....".to_string(),
        "...#.....#...........##..##....#.....#.................#.....................................#......#....##...#.............#......".to_string(),
        "..........#.........................#...........................#.#........#.........#..#.....#.........#....#..##...#.#......#....".to_string(),
        "............................#.....#.#..#...#..................#.....................#........##..#............#....................".to_string(),
        "......#.............#........................................#.........#........................#..#...........#...#..#.....#......".to_string(),
        "...........#.....#................#.#..#........#...........#.....##...............................#...............#..........##...".to_string(),
        "......................#.........................#.........#....#...............................##.......#..#....#...#..............".to_string(),
        "..#.....#.......#....................##...........#...........#.................#.......#..........................................".to_string(),
        "....#....#..#............#......#..#..#.#..#......#...................#.........#...............#.#..#....................#........".to_string(),
        "........##..............................#.#.................##......................#...............#..#......#......#..........#..".to_string(),
        ".....#..#...........#.#.......#...............#.................................#......#...........................................".to_string(),
        "....##.##............#..............#..#..............#.........#...................................#.......#......................".to_string(),
        ".....#....#.....#........#......#..............................#...........#.........##......#...#............##...................".to_string(),
        "....#..........#..#............##..#....#.#....#..#.............#...........#.#............#......#........#.......#.#.............".to_string(),
        "........#..##.....#......##...............#......#.#.............................#..#...#........#....#..............#........#....".to_string(),
        "..#.................#....#...#........##.....#.............................#..#.#......#.....#...#................#................".to_string(),
        "...........#.#....................#.......##.........................................#..............#..#.............#.......#.....".to_string(),
        "..#.....#......#.....................................#......................................#................#.#........#..........".to_string(),
        "...................................................................................................................................".to_string(),
    ]
}


#[test]
fn testl_s0()
{
    let v = get_big_field();
    assert_eq!(part2(&v,6),16);
}

#[test]
fn testl_s1()
{    
    let v = get_big_field();
    assert_eq!(part2(&v,10),50);
}

#[test]
fn testl_s2()
{
    let v = get_big_field();
    assert_eq!(part2(&v,50), 1594);
}

#[test]
fn testl_s3()
{
    let v = get_big_field();
    assert_eq!(part2(&v,500), 167004);
}

#[test]
fn testl_4()
{
    let v = get_big_field();
    assert_eq!(part2(&v,1000), 668697);
}

#[test]
fn testl_5()
{
    let v = get_big_field();
    assert_eq!(part2(&v,5000), 16733044);
}

#[test]
fn testl_6()
{
    let v = get_big_field();
    assert_eq!(part2(&v,10000), 66931436);
}

#[test]
fn testl_7()
{
    let v = get_big_field();
    assert_eq!(part2(&v,50000), 1673523504);
}

#[test]
fn testl_8()
{
    let v = get_big_field();
    assert_eq!(part2(&v,100000), 6694148697);
}

#[test]
fn testl_9()
{
    let v = get_big_field();
    assert_eq!(part2(&v,500000), 167355128044);
}

#[test]
fn testl_10()
{
    let v = get_big_field();
    assert_eq!(part2(&v,1000000), 669420421436);
}

#[test]
fn testl_11()
{
    let v = get_big_field();
    assert_eq!(part2(&v,5000000), 16735534173504);
}

#[test]
fn testl_12()
{
    let v = get_big_field();
    assert_eq!(part2(&v,10000000), 66942142148697);
}

#[test]
fn testl_13()
{
    let v = get_big_field();
    assert_eq!(part2(&v,50000000), 1673553694628044);
}

#[test]
fn testl_14()
{
    let v = get_big_field();
    assert_eq!(part2(&v,100000000), 6694214769421436);
}



#[test]
fn testl_r1()
{
    let v = get_big_field();
    assert_eq!(part2(&v,51), 1653);
}

#[test]
fn testl_r2()
{
    let v = get_big_field();
    assert_eq!(part2(&v,501), 167726);
}

#[test]
fn testl_r3()
{
    let v = get_big_field();
    assert_eq!(part2(&v,1001), 669704);
}

#[test]
fn testl_b1()
{
    let v = get_21_field();
    assert_eq!(part2(&v,151), 20954);
}

#[test]
fn testl_b2()
{
    let v = get_21_field();
    assert_eq!(part2(&v,251), 57636);
}

#[test]
fn testl_b3()
{
    let v = get_21_field();
    assert_eq!(part2(&v,501), 228740);
}

#[test]
fn testl_b4()
{
    let v = get_21_field();
    assert_eq!(part2(&v,281), 72174);
}

#[test]
fn testl_b5()
{
    let v = get_21_field();
    assert_eq!(part2(&v,701), 447076);
}

/*
---- day21::testl_b3 stdout ----
pos = Vec2 { x: 0, y: 0 }
[    0] [    0] [    0] [    0] [  868] [    0] [    0] [    0] [    0]
[    0] [    0] [    0] [ 2708] [ 7568] [ 2701] [    0] [    0] [    0]
[    0] [    0] [ 2708] [ 7681] [ 7787] [ 7678] [ 2701] [    0] [    0]
[    0] [ 2708] [ 7681] [ 7787] [ 7791] [ 7787] [ 7678] [ 2701] [    0]
[  869] [ 7572] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 7565] [  858]
[    0] [ 2678] [ 7682] [ 7787] [ 7791] [ 7787] [ 7678] [ 2694] [    0]
[    0] [    0] [ 2678] [ 7682] [ 7787] [ 7678] [ 2694] [    0] [    0]
[    0] [    0] [    0] [ 2678] [ 7569] [ 2694] [    0] [    0] [    0]
[    0] [    0] [    0] [    0] [  843] [    0] [    0] [    0] [    0]
odd    7787
even   7791

pos = Vec2 { x: 0, y: 0 }
[    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0]
[    0] [    0] [    0] [    0] [    0] [  496] [ 4726] [  505] [    0] [    0] [    0] [    0] [    0]
[    0] [    0] [    0] [    0] [  496] [ 6181] [ 7787] [ 6173] [  505] [    0] [    0] [    0] [    0]
[    0] [    0] [    0] [  496] [ 6181] [ 7787] [ 7791] [ 7787] [ 6173] [  505] [    0] [    0] [    0]
[    0] [    0] [  496] [ 6181] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 6173] [  505] [    0] [    0]
[    0] [  496] [ 6181] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 6173] [  505] [    0]
[    0] [ 4744] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 4710] [    0]
[    0] [  496] [ 6191] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 6162] [  505] [    0]
[    0] [    0] [  496] [ 6191] [ 7787] [ 7791] [ 7787] [ 7791] [ 7787] [ 6162] [  505] [    0] [    0]
[    0] [    0] [    0] [  496] [ 6191] [ 7787] [ 7791] [ 7787] [ 6162] [  505] [    0] [    0] [    0]
[    0] [    0] [    0] [    0] [  496] [ 6191] [ 7787] [ 6162] [  505] [    0] [    0] [    0] [    0]
[    0] [    0] [    0] [    0] [    0] [  496] [ 4727] [  505] [    0] [    0] [    0] [    0] [    0]
[    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0] [    0]
odd    7787
even   7791
even2  7791
even3  7791

*/


